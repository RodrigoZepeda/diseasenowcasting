<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to diseasenowcasting • diseasenowcasting</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to diseasenowcasting">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-secondary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">diseasenowcasting</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/diseasenowcasting.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Advanced-nowcast-options.html">Advanced nowcast options</a></li>
    <li><a class="dropdown-item" href="../articles/Comparison-to-other-methods.html">Comparison to other methods</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RodrigoZepeda/diseasenowcasting/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to diseasenowcasting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RodrigoZepeda/diseasenowcasting/blob/master/vignettes/articles/diseasenowcasting.Rmd" class="external-link"><code>vignettes/articles/diseasenowcasting.Rmd</code></a></small>
      <div class="d-none name"><code>diseasenowcasting.Rmd</code></div>
    </div>

    
    
<p>The <code>diseasenowcasting</code> package provides a
disease-agnostic framework for nowcasting the number of cases affected
by certain disease.</p>
<div class="section level2">
<h2 id="what-is-nowcasting">What is nowcasting?<a class="anchor" aria-label="anchor" href="#what-is-nowcasting"></a>
</h2>
<p>In many applications, it is of interest to predict the
<strong>current</strong> number of cases as there might be a lag in the
registry. Examples of lags can be administrative such as tests taking
time to yield results, sociological such as patients taking time to
report at their healthcare facility after symptom onset or biological:
symptoms not happening at the same time as colonization. In such cases
you might end up with registries looking like the one in Figure 1: where
the number of cases observed by today is an incomplete fraction of the
overall number of cases that will eventually be registered.</p>
<div class="figure">
<img src="diseasenowcasting_files/figure-html/unnamed-chunk-2-1.png" alt="Current number of cases for a certain disease (left) vs the eventual number of registered cases for that disease (right)" width="100%"><p class="caption">
Current number of cases for a certain disease (left) vs the eventual
number of registered cases for that disease (right)
</p>
</div>
<p>The difference between the current observed number of cases and the
final number of cases that will eventually be reported is accounted for
by a model. By <strong>nowcasting</strong>, we refer to predicting the
number of cases for a specific disease in a date that has already
happened (or is currently happening) and for which we have incomplete
information. The most basic example involves predicting the number of
cases for <strong>now</strong> given that we have already seen some of
today’s cases arrive at our system but not all of them yet. Hence the
nowcast refers to the number of cases that we will eventually observe
for a certain time frame as depicted in Figure 2:</p>
<div class="figure">
<img src="diseasenowcasting_files/figure-html/unnamed-chunk-3-1.png" alt="Nowcasted number of cases for the disease of the previous image given that we had only observed a fraction of them" width="75%"><p class="caption">
Nowcasted number of cases for the disease of the previous image given
that we had only observed a fraction of them
</p>
</div>
<p>This vignette will give you an overview of the basics of the
<code>diseasenowcasting</code> package. The typical workflow involves
the following steps:</p>
<ol style="list-style-type: decimal">
<li>
<a href="#getting-the-data">Getting the data</a>.</li>
<li>
<a href="#fitting-a-model">Fitting a model</a>.</li>
<li>
<a href="#evaluating-the-model">Evaluating the model</a>.</li>
<li>
<a href="#updating-with-new-data">Updating with new data</a>.</li>
</ol>
<p>In this tutorial we will focus only on the steps in a reproducible
manner and we will refer to specific vignettes for advanced usage on
each of the steps.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">26758</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rodrigozepeda.github.io/diseasenowcasting/">diseasenowcasting</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="getting-the-data">1. Getting the data<a class="anchor" aria-label="anchor" href="#getting-the-data"></a>
</h2>
<p>Data for the <code>nowcasting</code> function should be either
individual-level data or line-list data. In any case at least two
columns in <code>Date</code> format are required: the
<code>true_date</code> and the <code>report_date</code>.</p>
<ul>
<li>
<code>true_date</code> Refers to the date when the case
happened.</li>
<li>
<code>report_date</code> Refers to the date when the case was
reported.</li>
</ul>
<blockquote>
<p>In general we assume that the <code>true_date</code> always happened
before the <code>report_date</code> as you cannot report something that
hasn’t already happened.</p>
</blockquote>
<div class="section level3">
<h3 id="types-of-data">Types of data<a class="anchor" aria-label="anchor" href="#types-of-data"></a>
</h3>
<div class="section level4">
<h4 id="individual-level-data">Individual-level data<a class="anchor" aria-label="anchor" href="#individual-level-data"></a>
</h4>
<p>By individual-level data we mean a dataset for which each row
represents a case. For example, the <code>denguedat</code> dataset
included in the package contains individual-level data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Call the dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"denguedat"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Preview </span></span>
<span><span class="va">denguedat</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   onset_week report_week gender</span></span>
<span><span class="co">#&gt; 1 1990-01-01  1990-01-01   Male</span></span>
<span><span class="co">#&gt; 2 1990-01-01  1990-01-01 Female</span></span>
<span><span class="co">#&gt; 3 1990-01-01  1990-01-01 Female</span></span>
<span><span class="co">#&gt; 4 1990-01-01  1990-01-08 Female</span></span>
<span><span class="co">#&gt; 5 1990-01-01  1990-01-08   Male</span></span>
<span><span class="co">#&gt; 6 1990-01-01  1990-01-15 Female</span></span></code></pre></div>
<p>Notice that beyond the two dates (here
<code>true_date = "onset_week"</code> and
<code>report_date = "report_week"</code>) there can be additional
covariates in the data (such as <code>gender</code> in this
example).</p>
</div>
<div class="section level4">
<h4 id="line-list-data">Line-list data<a class="anchor" aria-label="anchor" href="#line-list-data"></a>
</h4>
<p>By line-list data we mean a dataset for which each row represents a
count of cases For example, the <code>mpoxdat</code> dataset included in
the package contains line-list data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Call the dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mpoxdat"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Preview </span></span>
<span><span class="va">mpoxdat</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Rowwise: </span></span></span>
<span><span class="co">#&gt;   dx_date    dx_report_date race                   n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2022-07-08 2022-07-12     Asian                  4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2022-07-08 2022-07-12     Black                  6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2022-07-08 2022-07-12     Hispanic               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2022-07-08 2022-07-12     Non-Hispanic White     6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2022-07-08 2022-07-13     Asian                  2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2022-07-08 2022-07-13     Black                  3</span></span></code></pre></div>
<p>Both line-list and individual-level data can be used in the package.
Also, the package allows for different time granularity. The
<code>denguedat</code> contains counts per week while
<code>mpoxdat</code> has counts per day. Both weekly and daily time
frames are usable in <code>diseasenowcasting</code>.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="fitting-the-nowcast">2. Fitting the nowcast<a class="anchor" aria-label="anchor" href="#fitting-the-nowcast"></a>
</h2>
<p>You can use the <code><a href="../reference/nowcast.html">nowcast()</a></code> function to generate nowcasts
for your data. In the following example we use only a fraction of
<code>denguedat</code>: until October 1990 to speed things up (you can
use the whole denguedat if you want):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Reduce the dataset</span></span>
<span><span class="va">denguedat_fraction</span> <span class="op">&lt;-</span> <span class="va">denguedat</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">report_week</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1990/10/01"</span>, format <span class="op">=</span> <span class="st">"%Y/%m/%d"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For the nowcast we specify which one is the <code>true_date</code>
and which one corresponds to the <code>report_date</code>. Remember that
the <code>true_date</code> should always be smaller or equal to the
<code>report_date</code> as the assumption is that no cases can be
reported before happening:</p>
<blockquote>
<p><strong>Note</strong> For this example we are setting the method to
variational just to improve the speed of the example. The sampling
method should always be prefered.</p>
</blockquote>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Generate the nowcast. Set verbose option t</span></span>
<span><span class="va">ncast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nowcast.html">nowcast</a></span><span class="op">(</span><span class="va">denguedat_fraction</span>, true_date <span class="op">=</span> <span class="st">"onset_week"</span>, </span>
<span>                 report_date <span class="op">=</span> <span class="st">"report_week"</span>,</span>
<span>                 method <span class="op">=</span> <span class="st">"variational"</span><span class="op">)</span> <span class="co">#&lt;- Change to sampling when in production</span></span></code></pre></div>
<p>The <code>ncast</code> object itself shows the characteristics of the
fitted model:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncast</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Nowcast for </span><span style="color: #0000BB; font-weight: bold;">1990-10-01</span> ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; • Column with `true_date` = <span style="color: #0000BB;">"onset_week"</span></span></span>
<span><span class="co">#&gt; • Column with `report_date` = <span style="color: #0000BB;">"report_week"</span></span></span>
<span><span class="co">#&gt; • units = <span style="color: #0000BB;">"weeks"</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Epidemic effects:</span></span>
<span><span class="co">#&gt; The following effects are in place:</span></span>
<span><span class="co">#&gt;   • <span style="font-style: italic;">week_of_year</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Delay effects:</span></span>
<span><span class="co">#&gt; No temporal effects are considered</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use the `summary` function to obtain the summary of predictions or `plot` to</span></span>
<span><span class="co">#&gt; generate an image</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>You can generate plots of the <code>nowcast</code> with the
<code>plot</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ncast</span>, title <span class="op">=</span> <span class="st">"Nowcast"</span><span class="op">)</span></span></code></pre></div>
<p><img src="diseasenowcasting_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>And get the predictions with the summary function</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ncast</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 40 × 7</span></span></span>
<span><span class="co">#&gt;    onset_week  mean    sd median  `5%` `95%` Strata_unified</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1990-01-01    61     0     61    61    61 No strata     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1990-01-08    50     0     50    50    50 No strata     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1990-01-15    44     0     44    44    44 No strata     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1990-01-22    46     0     46    46    46 No strata     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1990-01-29    39     0     39    39    39 No strata     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1990-02-05    34     0     34    34    34 No strata     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1990-02-12    24     0     24    24    24 No strata     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1990-02-19    17     0     17    17    17 No strata     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1990-02-26    17     0     17    17    17 No strata     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1990-03-05    16     0     16    16    16 No strata     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 30 more rows</span></span></span></code></pre></div>
<p>You can see how to add holiday effects, change the priors, and add
further options to the model, in the <a href="https://rodrigozepeda.github.io/diseasenowcasting/articles/Advanced-nowcast-options.html">Advanced
nowcast options</a>.</p>
<p>For now we will show you how to evaluate a nowcast once it has been
prepared:</p>
</div>
<div class="section level2">
<h2 id="evaluating-the-model">3. Evaluating the model<a class="anchor" aria-label="anchor" href="#evaluating-the-model"></a>
</h2>
<p>Once a nowcast has been constructed you can use the [backtest()]
function to evaluate what the current model would have predicted in the
past vs what was actually observed. Here, for example, we are evaluating
what the model predicted for May, June and July:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#This will take a while as it refits the model several times</span></span>
<span><span class="va">btest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backtest.html">backtest</a></span><span class="op">(</span><span class="va">ncast</span>, start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1990/05/01"</span><span class="op">)</span>, end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1990/07/31"</span><span class="op">)</span>, refresh <span class="op">=</span> <span class="fl">0</span>, model_name<span class="op">=</span><span class="st">'model_NB'</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/backtest_metrics.html">backtest_metrics()</a></code> function calculates the mean
absolute error (<code>mae</code>), root mean squared error
(<code>rmse</code>) and weighted interval scoring
(<code>wis</code>):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#This will take a while as it refits the model several times</span></span>
<span><span class="va">mtr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backtest_metrics.html">backtest_metrics</a></span><span class="op">(</span><span class="va">btest</span><span class="op">)</span></span>
<span><span class="va">mtr</span></span>
<span><span class="co">#&gt;       model        now horizon Strata_unified    mae   rmse       ape      wis</span></span>
<span><span class="co">#&gt; 1  model_NB 1990-05-07       0      No strata 16.587 16.587 3.3174000 7.821429</span></span>
<span><span class="co">#&gt; 2  model_NB 1990-05-14       0      No strata 13.524 13.524 1.9320000 5.000000</span></span>
<span><span class="co">#&gt; 3  model_NB 1990-05-21       0      No strata 16.621 16.621 5.5403333 7.672143</span></span>
<span><span class="co">#&gt; 4  model_NB 1990-05-28       0      No strata 14.775 14.775 2.9550000 6.564464</span></span>
<span><span class="co">#&gt; 5  model_NB 1990-06-04       0      No strata 16.846 16.846 5.6153333 8.278750</span></span>
<span><span class="co">#&gt; 6  model_NB 1990-06-11       0      No strata 14.631 14.631 2.4385000 6.786429</span></span>
<span><span class="co">#&gt; 7  model_NB 1990-06-18       0      No strata 14.240 14.240 2.3733333 6.671429</span></span>
<span><span class="co">#&gt; 8  model_NB 1990-06-25       0      No strata 11.011 11.011 1.0010000 4.128571</span></span>
<span><span class="co">#&gt; 9  model_NB 1990-07-02       0      No strata 13.246 13.246 2.2076667 5.942857</span></span>
<span><span class="co">#&gt; 10 model_NB 1990-07-09       0      No strata 13.130 13.130 1.6412500 5.064286</span></span>
<span><span class="co">#&gt; 11 model_NB 1990-07-16       0      No strata 13.359 13.359 2.2265000 5.500000</span></span>
<span><span class="co">#&gt; 12 model_NB 1990-07-23       0      No strata 12.644 12.644 1.8062857 4.757143</span></span>
<span><span class="co">#&gt; 13 model_NB 1990-07-30       0      No strata  3.393  3.393 0.1995882 1.714464</span></span>
<span><span class="co">#&gt;    overprediction underprediction dispersion bias interval_coverage_50</span></span>
<span><span class="co">#&gt; 1       6.1428571               0   1.678571 1.00                    0</span></span>
<span><span class="co">#&gt; 2       3.2857143               0   1.714286 0.90                    0</span></span>
<span><span class="co">#&gt; 3       6.0000000               0   1.672143 1.00                    0</span></span>
<span><span class="co">#&gt; 4       5.0000000               0   1.564464 1.00                    0</span></span>
<span><span class="co">#&gt; 5       6.7142857               0   1.564464 1.00                    0</span></span>
<span><span class="co">#&gt; 6       5.2714286               0   1.515000 1.00                    0</span></span>
<span><span class="co">#&gt; 7       5.2857143               0   1.385714 1.00                    0</span></span>
<span><span class="co">#&gt; 8       2.5714286               0   1.557143 0.90                    0</span></span>
<span><span class="co">#&gt; 9       4.5714286               0   1.371429 1.00                    0</span></span>
<span><span class="co">#&gt; 10      3.4285714               0   1.635714 0.90                    0</span></span>
<span><span class="co">#&gt; 11      4.0000000               0   1.500000 0.95                    0</span></span>
<span><span class="co">#&gt; 12      3.2857143               0   1.471429 0.90                    0</span></span>
<span><span class="co">#&gt; 13      0.2857143               0   1.428750 0.50                    1</span></span>
<span><span class="co">#&gt;    interval_coverage_90 ae_median</span></span>
<span><span class="co">#&gt; 1                     0        15</span></span>
<span><span class="co">#&gt; 2                     1        11</span></span>
<span><span class="co">#&gt; 3                     0        14</span></span>
<span><span class="co">#&gt; 4                     0        13</span></span>
<span><span class="co">#&gt; 5                     0        15</span></span>
<span><span class="co">#&gt; 6                     0        13</span></span>
<span><span class="co">#&gt; 7                     0        13</span></span>
<span><span class="co">#&gt; 8                     1        10</span></span>
<span><span class="co">#&gt; 9                     0        12</span></span>
<span><span class="co">#&gt; 10                    1        12</span></span>
<span><span class="co">#&gt; 11                    0        12</span></span>
<span><span class="co">#&gt; 12                    1        11</span></span>
<span><span class="co">#&gt; 13                    1         2</span></span></code></pre></div>
<p>You can generate a summary and and plot
<code><a href="../reference/backtest_metrics.html">backtest_metrics()</a></code> object with the<code>summary</code> and
<code>plot</code> functions.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mtr</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 8</span></span></span>
<span><span class="co">#&gt;    model    Strata_unified horizon metric                 avg    sd n_now     se</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> model_NB No strata      0       ae_median          11.8    3.30     13 0.914 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> model_NB No strata      0       ape                 2.56   1.56     13 0.431 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> model_NB No strata      0       bias                0.927  0.136    13 0.037<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> model_NB No strata      0       dispersion          1.54   0.111    13 0.030<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> model_NB No strata      0       interval_coverage…  0.076<span style="text-decoration: underline;">9</span> 0.277    13 0.076<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> model_NB No strata      0       interval_coverage…  0.385  0.506    13 0.140 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> model_NB No strata      0       mae                13.4    3.45     13 0.958 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> model_NB No strata      0       overprediction      4.30   1.75     13 0.484 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> model_NB No strata      0       rmse               13.4    3.45     13 0.958 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> model_NB No strata      0       underprediction     0      0        13 0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> model_NB No strata      0       wis                 5.84   1.78     13 0.493</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mtr</span>, title <span class="op">=</span> <span class="st">"Backtest"</span><span class="op">)</span></span></code></pre></div>
<p><img src="diseasenowcasting_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p><code>backtest_metrics</code> works with multiple
<code>backtest</code> objects</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#creating a new nowcast using a Poisson distribution</span></span>
<span><span class="va">ncast2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nowcast.html">nowcast</a></span><span class="op">(</span><span class="va">denguedat_fraction</span>, true_date <span class="op">=</span> <span class="st">"onset_week"</span>, </span>
<span>                 report_date <span class="op">=</span> <span class="st">"report_week"</span>,</span>
<span>                method <span class="op">=</span> <span class="st">"variational"</span>, dist <span class="op">=</span> <span class="st">"Poisson"</span><span class="op">)</span> </span>
<span><span class="va">btest2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backtest.html">backtest</a></span><span class="op">(</span><span class="va">ncast2</span>, start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1990/05/01"</span><span class="op">)</span>, end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1990/07/31"</span><span class="op">)</span>, refresh <span class="op">=</span> <span class="fl">0</span>, model_name<span class="op">=</span><span class="st">'model_Poisson'</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">comparison_mtr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backtest_metrics.html">backtest_metrics</a></span><span class="op">(</span><span class="va">btest</span>, <span class="va">btest2</span><span class="op">)</span></span></code></pre></div>
<p>generate a summary of the comparison with <code>summary</code> and
generate a plot with <code>plot</code></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">comparison_mtr</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 22 × 8</span></span></span>
<span><span class="co">#&gt;    model    Strata_unified horizon metric                 avg    sd n_now     se</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> model_NB No strata      0       ae_median          11.8    3.30     13 0.914 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> model_NB No strata      0       ape                 2.56   1.56     13 0.431 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> model_NB No strata      0       bias                0.927  0.136    13 0.037<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> model_NB No strata      0       dispersion          1.54   0.111    13 0.030<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> model_NB No strata      0       interval_coverage…  0.076<span style="text-decoration: underline;">9</span> 0.277    13 0.076<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> model_NB No strata      0       interval_coverage…  0.385  0.506    13 0.140 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> model_NB No strata      0       mae                13.4    3.45     13 0.958 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> model_NB No strata      0       overprediction      4.30   1.75     13 0.484 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> model_NB No strata      0       rmse               13.4    3.45     13 0.958 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> model_NB No strata      0       underprediction     0      0        13 0     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more rows</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">comparison_mtr</span>, title <span class="op">=</span> <span class="st">"Backtest comparison"</span><span class="op">)</span></span></code></pre></div>
<p><img src="diseasenowcasting_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="updating-with-new-data">4. Updating with new data<a class="anchor" aria-label="anchor" href="#updating-with-new-data"></a>
</h2>
<p>The <code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code> function takes an existing nowcast and
updates it with <code>new_data</code> to generate predictions for a more
recent now. For example, consider now the <code>denguedat</code>
information with one additional new week:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#This new dataset contains a new additional week</span></span>
<span><span class="va">denguedat_fraction_updated</span> <span class="op">&lt;-</span> <span class="va">denguedat</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">report_week</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1990/10/08"</span>, format <span class="op">=</span> <span class="st">"%Y/%m/%d"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can update our nowcast with this new data:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncast_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">ncast</span>, new_data <span class="op">=</span> <span class="va">denguedat_fraction_updated</span><span class="op">)</span></span></code></pre></div>
<p>And do the same operations as before:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ncast_2</span>, title <span class="op">=</span> <span class="st">"Updated nowcast"</span><span class="op">)</span></span></code></pre></div>
<p><img src="diseasenowcasting_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rodrigo Zepeda-Tello, Rami Yaari, Matteo Perini, Columbia University in the City of New York.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
